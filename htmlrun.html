<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML Code Editor with Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <style>
        .CodeMirror {
            height: 450px;
            border: 1px solid #374151;
            border-radius: 0.375rem;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .CodeMirror.fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            height: 100vh !important;
            width: 100vw !important;
            z-index: 9999 !important;
            border-radius: 0 !important;
        }
        .fullscreen-overlay {
            display: none;
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 10000;
        }
        .fullscreen-overlay.active {
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-blue-400 mb-2">üñ•Ô∏è HTML Code Editor</h1>
            <p class="text-gray-400">Write, Run, Save & Load HTML Code</p>
        </div>

        <!-- Supabase Config -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <h2 class="text-lg font-semibold mb-3 text-yellow-400">‚öôÔ∏è Supabase Configuration</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Supabase URL</label>
                    <input type="text" id="supabaseUrl" value="https://vlrglwotjlfamnpzaeir.supabase.co"
                        class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Supabase Anon Key</label>
                    <input type="password" id="supabaseKey" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZscmdsd290amxmYW1ucHphZWlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyNjYzMzYsImV4cCI6MjA3MDg0MjMzNn0.cwHu4vQlulKZQwNHD7ENT2zN_rZG4LkEQxJTjlIT12Q"
                        class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500">
                </div>
            </div>
            <button onclick="connectSupabase()" class="mt-3 bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-sm font-medium transition">
                üîó Connect to Supabase
            </button>
            <span id="connectionStatus" class="ml-3 text-sm"></span>
        </div>

        <!-- HTML Code Editor -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6" id="editorContainer">
            <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold text-orange-400">üìÑ HTML Code</h3>
                <div class="flex gap-2">
                    <button onclick="toggleDarkMode()" id="darkModeBtn" class="bg-gray-600 hover:bg-gray-700 px-3 py-1 rounded text-sm font-medium transition">
                        üåô Dark Mode
                    </button>
                    <button onclick="toggleFullscreen()" id="fullscreenBtn" class="bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-sm font-medium transition">
                        ‚õ∂ Fullscreen
                    </button>
                    <button onclick="resetAll()" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm font-medium transition">
                        üîÑ Reset
                    </button>
                </div>
            </div>
            <textarea id="htmlCode"></textarea>
        </div>

        <!-- Fullscreen Overlay Buttons -->
        <div id="fullscreenOverlay" class="fullscreen-overlay">
            <button onclick="toggleDarkMode()" id="darkModeBtnFS" class="bg-gray-600 hover:bg-gray-700 px-3 py-2 rounded text-sm font-medium transition text-white">
                üåô Dark Mode
            </button>
            <button onclick="toggleFullscreen()" class="bg-red-600 hover:bg-red-700 px-3 py-2 rounded text-sm font-medium transition text-white">
                ‚úï Exit Fullscreen
            </button>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-3 mb-6 justify-center">
            <button onclick="runCode()" id="runBtn" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg font-semibold transition flex items-center gap-2">
                ‚ñ∂Ô∏è Run Code
            </button>
            <button onclick="stopCode()" id="stopBtn" class="bg-red-600 hover:bg-red-700 px-6 py-3 rounded-lg font-semibold transition flex items-center gap-2 hidden">
                ‚èπÔ∏è Stop Code
            </button>
            <button onclick="openInNewTab()" class="bg-orange-600 hover:bg-orange-700 px-6 py-3 rounded-lg font-semibold transition flex items-center gap-2">
                üîó Open in New Tab
            </button>
            <button onclick="downloadCode()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-semibold transition flex items-center gap-2">
                üì• Download
            </button>
            <label class="bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded-lg font-semibold transition flex items-center gap-2 cursor-pointer">
                üì§ Import File
                <input type="file" accept=".html,.htm" onchange="importFile(event)" class="hidden">
            </label>
        </div>

        <!-- Supabase Operations -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <h2 class="text-lg font-semibold mb-3 text-cyan-400">üíæ Supabase Operations</h2>
            <div class="flex flex-wrap gap-3 items-end">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Code ID</label>
                    <input type="number" id="codeId" placeholder="Enter ID" min="1"
                        class="w-32 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-blue-500">
                </div>
                <button onclick="saveToSupabase()" class="bg-teal-600 hover:bg-teal-700 px-4 py-2 rounded font-medium transition">
                    üíæ Save to Supabase
                </button>
                <button onclick="loadFromSupabase()" class="bg-cyan-600 hover:bg-cyan-700 px-4 py-2 rounded font-medium transition">
                    üìÇ Load from Supabase
                </button>
                <button onclick="loadAllFromSupabase()" class="bg-violet-600 hover:bg-violet-700 px-4 py-2 rounded font-medium transition">
                    üìã Load All Records
                </button>
                <button onclick="deleteFromSupabase()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded font-medium transition">
                    üóëÔ∏è Delete Record
                </button>
            </div>
        </div>

        <!-- Saved Records List -->
        <div id="recordsList" class="bg-gray-800 rounded-lg p-4 mb-6 hidden">
            <h2 class="text-lg font-semibold mb-3 text-pink-400">üìã Saved Records</h2>
            <div id="recordsContainer" class="space-y-2 max-h-48 overflow-y-auto"></div>
        </div>

        <!-- Preview -->
        <div class="bg-gray-800 rounded-lg p-4">
            <h2 class="text-lg font-semibold mb-3 text-green-400">üëÅÔ∏è Preview</h2>
            <div class="bg-white rounded-lg overflow-hidden" style="min-height: 400px;">
                <iframe id="preview" class="w-full h-96 border-0"></iframe>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-4 right-4 px-6 py-3 rounded-lg font-medium transform translate-y-20 opacity-0 transition-all duration-300"></div>
    </div>

    <script>
        let htmlEditor;
        let supabase = null;
        let isDarkMode = false;
        let isFullscreen = false;
        let isRunning = false;

        const defaultCode = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page</title>
    <style>
        .container {
            text-align: center;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        h1 {
            color: #3b82f6;
        }
        button {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hello World!</h1>
        <p>Start coding...</p>
        <button onclick="sayHello()">Click Me</button>
    </div>
    <script>
        function sayHello() {
            alert('Hello from JavaScript!');
        }
    <\/script>
</body>
</html>`;

        // Save settings to localStorage
        function saveSettings() {
            const settings = {
                code: htmlEditor.getValue(),
                isDarkMode: isDarkMode,
                codeId: document.getElementById('codeId').value
            };
            localStorage.setItem('htmlEditorSettings', JSON.stringify(settings));
        }

        // Load settings from localStorage
        function loadSettings() {
            const saved = localStorage.getItem('htmlEditorSettings');
            if (saved) {
                try {
                    const settings = JSON.parse(saved);
                    
                    // Load code
                    if (settings.code) {
                        htmlEditor.setValue(settings.code);
                    } else {
                        htmlEditor.setValue(defaultCode);
                    }
                    
                    // Load dark mode
                    if (settings.isDarkMode) {
                        isDarkMode = false; // Will be toggled to true
                        toggleDarkMode();
                    }
                    
                    // Load code ID
                    if (settings.codeId) {
                        document.getElementById('codeId').value = settings.codeId;
                    }
                    
                    showToast('Settings restored from browser');
                } catch (e) {
                    htmlEditor.setValue(defaultCode);
                }
            } else {
                htmlEditor.setValue(defaultCode);
            }
        }

        // Initialize CodeMirror editor
        document.addEventListener('DOMContentLoaded', () => {
            htmlEditor = CodeMirror.fromTextArea(document.getElementById('htmlCode'), {
                mode: 'htmlmixed',
                theme: 'default',
                lineNumbers: true,
                lineWrapping: true
            });

            // Auto-save on code change
            htmlEditor.on('change', () => {
                saveSettings();
            });

            // ESC key to exit fullscreen
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && isFullscreen) {
                    toggleFullscreen();
                }
            });

            // Load saved settings
            loadSettings();

            // Auto-connect to Supabase on load
            connectSupabase();
        });

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg font-medium transform transition-all duration-300 ${
                type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            toast.style.transform = 'translateY(0)';
            toast.style.opacity = '1';
            setTimeout(() => {
                toast.style.transform = 'translateY(20px)';
                toast.style.opacity = '0';
            }, 3000);
        }

        // Run code in preview
        function runCode() {
            const html = htmlEditor.getValue();

            const iframe = document.getElementById('preview');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            iframeDoc.open();
            iframeDoc.write(html);
            iframeDoc.close();

            isRunning = true;
            document.getElementById('runBtn').classList.add('hidden');
            document.getElementById('stopBtn').classList.remove('hidden');

            showToast('Code executed successfully!');
        }

        // Stop code execution
        function stopCode() {
            const iframe = document.getElementById('preview');
            
            // Clear the iframe by loading a blank page
            iframe.srcdoc = '<html><body style="display:flex;align-items:center;justify-content:center;height:100vh;margin:0;font-family:Arial,sans-serif;color:#666;"><p>‚èπÔ∏è Code execution stopped</p></body></html>';
            
            isRunning = false;
            document.getElementById('runBtn').classList.remove('hidden');
            document.getElementById('stopBtn').classList.add('hidden');

            showToast('Code execution stopped!');
        }

        // Open code in new tab
        function openInNewTab() {
            const html = htmlEditor.getValue();
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');
            showToast('Opened in new tab!');
        }

        // Download code as HTML file
        function downloadCode() {
            const html = htmlEditor.getValue();

            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'code.html';
            a.click();
            URL.revokeObjectURL(url);

            showToast('Code downloaded!');
        }

        // Import HTML file
        function importFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                htmlEditor.setValue(content);
                showToast('File imported successfully!');
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Reset all editors
        function resetAll() {
            if (confirm('Are you sure you want to reset all code?')) {
                htmlEditor.setValue('');
                document.getElementById('preview').srcdoc = '';
                document.getElementById('codeId').value = '';
                showToast('All code has been reset!');
            }
        }

        // Toggle Dark Mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            const theme = isDarkMode ? 'dracula' : 'default';
            htmlEditor.setOption('theme', theme);
            
            const darkModeBtn = document.getElementById('darkModeBtn');
            const darkModeBtnFS = document.getElementById('darkModeBtnFS');
            
            if (isDarkMode) {
                darkModeBtn.innerHTML = '‚òÄÔ∏è Light Mode';
                darkModeBtnFS.innerHTML = '‚òÄÔ∏è Light Mode';
                showToast('Dark mode enabled');
            } else {
                darkModeBtn.innerHTML = 'üåô Dark Mode';
                darkModeBtnFS.innerHTML = 'üåô Dark Mode';
                showToast('Light mode enabled');
            }
            
            // Save dark mode setting
            saveSettings();
        }

        // Toggle Fullscreen
        function toggleFullscreen() {
            isFullscreen = !isFullscreen;
            const cmElement = document.querySelector('.CodeMirror');
            const overlay = document.getElementById('fullscreenOverlay');
            
            if (isFullscreen) {
                cmElement.classList.add('fullscreen');
                overlay.classList.add('active');
                showToast('Fullscreen mode - Press ESC to exit');
            } else {
                cmElement.classList.remove('fullscreen');
                overlay.classList.remove('active');
                showToast('Exited fullscreen');
            }
            
            // Refresh editor to fix any display issues
            setTimeout(() => htmlEditor.refresh(), 100);
        }

        // Connect to Supabase
        function connectSupabase() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();

            if (!url || !key) {
                showToast('Please enter Supabase URL and Key', 'error');
                return;
            }

            try {
                supabase = window.supabase.createClient(url, key);
                
                document.getElementById('connectionStatus').innerHTML = '<span class="text-green-400">‚úì Connected</span>';
                showToast('Connected to Supabase!');
            } catch (error) {
                document.getElementById('connectionStatus').innerHTML = '<span class="text-red-400">‚úó Failed</span>';
                showToast('Connection failed: ' + error.message, 'error');
            }
        }

        // Save to Supabase
        async function saveToSupabase() {
            if (!supabase) {
                showToast('Please connect to Supabase first', 'error');
                return;
            }

            const id = parseInt(document.getElementById('codeId').value);
            if (!id || id < 1) {
                showToast('Please enter a valid ID', 'error');
                return;
            }

            const html = htmlEditor.getValue();

            try {
                const { data, error } = await supabase
                    .from('html_codes')
                    .upsert({ id, html, css: '', js: '' }, { onConflict: 'id' });

                if (error) throw error;
                showToast(`Code saved with ID: ${id}`);
            } catch (error) {
                showToast('Save failed: ' + error.message, 'error');
            }
        }

        // Load from Supabase
        async function loadFromSupabase() {
            if (!supabase) {
                showToast('Please connect to Supabase first', 'error');
                return;
            }

            const id = parseInt(document.getElementById('codeId').value);
            if (!id || id < 1) {
                showToast('Please enter a valid ID', 'error');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('html_codes')
                    .select('*')
                    .eq('id', id)
                    .single();

                if (error) throw error;
                if (!data) {
                    showToast('No record found with this ID', 'error');
                    return;
                }

                htmlEditor.setValue(data.html || '');
                showToast(`Code loaded from ID: ${id}`);
            } catch (error) {
                showToast('Load failed: ' + error.message, 'error');
            }
        }

        // Load all records from Supabase
        async function loadAllFromSupabase() {
            if (!supabase) {
                showToast('Please connect to Supabase first', 'error');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('html_codes')
                    .select('id, html')
                    .order('id', { ascending: true });

                if (error) throw error;

                const recordsList = document.getElementById('recordsList');
                const container = document.getElementById('recordsContainer');

                if (!data || data.length === 0) {
                    recordsList.classList.add('hidden');
                    showToast('No records found', 'info');
                    return;
                }

                container.innerHTML = data.map(record => `
                    <div class="flex items-center justify-between bg-gray-700 rounded px-3 py-2">
                        <span class="text-sm">
                            <strong class="text-cyan-400">ID: ${record.id}</strong>
                            <span class="text-gray-400 ml-2">
                                HTML: ${(record.html || '').length} chars
                            </span>
                        </span>
                        <button onclick="loadRecordById(${record.id})" class="bg-cyan-600 hover:bg-cyan-700 px-3 py-1 rounded text-xs">
                            Load
                        </button>
                    </div>
                `).join('');

                recordsList.classList.remove('hidden');
                showToast(`Found ${data.length} records`);
            } catch (error) {
                showToast('Load failed: ' + error.message, 'error');
            }
        }

        // Load specific record by ID
        async function loadRecordById(id) {
            document.getElementById('codeId').value = id;
            await loadFromSupabase();
        }

        // Delete from Supabase
        async function deleteFromSupabase() {
            if (!supabase) {
                showToast('Please connect to Supabase first', 'error');
                return;
            }

            const id = parseInt(document.getElementById('codeId').value);
            if (!id || id < 1) {
                showToast('Please enter a valid ID', 'error');
                return;
            }

            if (!confirm(`Are you sure you want to delete record ID: ${id}?`)) {
                return;
            }

            try {
                const { error } = await supabase
                    .from('html_codes')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                showToast(`Record ${id} deleted`);
                loadAllFromSupabase();
            } catch (error) {
                showToast('Delete failed: ' + error.message, 'error');
            }
        }
    </script>
</body>
</html><style></style><script></script>
