<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Retro Gray QR + Barcode Scanner</title>

<!-- Library untuk QR (jsQR) dan QR generator (qrious) -->
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

<!-- Quagga untuk fallback decoding barcode 1D -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'VT323', monospace;
    background: #d3d3d3;
    color: #333;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
}
.container {
    background: #e0e0e0;
    border: 3px solid #808080;
    padding: 20px;
    box-shadow: 5px 5px 0px 0px rgba(0,0,0,0.75);
    max-width: 500px;
    width: 90%;
    text-align: center;
    border-radius: 0;
}
h1 { color: #333; }
#video {
    width: 100%;
    max-width: 400px;
    border: 2px solid #555;
    background: #000;
    margin: 0 auto 15px auto;
    filter: grayscale(100%) brightness(120%) contrast(150%);
    display: none;
}
#video-stream-container {
    position: relative;
    width: 100%;
    max-width: 400px;
    margin: 0 auto 15px auto;
}
#liveVideo, #contourCanvas {
    width: 100%;
    max-width: 400px;
    border: 2px solid #555;
    background: #000;
    display: none;
}
#snapshot { display: none; }
.controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }
button, #fileInputBtn {
    padding: 12px; font-size: 1.2em; border: 2px solid #808080;
    background: #c0c0c0; color: #333; cursor: pointer; font-family: 'VT323', monospace;
    text-transform: uppercase; box-shadow: 2px 2px 0px 0px rgba(0,0,0,0.75);
    transition: all 0.1s ease;
}
button:hover, #fileInputBtn:hover { background: #a0a0a0; transform: translate(1px, 1px); }
button:active, #fileInputBtn:active { background: #909090; transform: translate(2px, 2px); }
input[type="file"] { display: none; }

/* --- OUTPUT STATUS (DIUBAH: agar teks wrap ke bawah, tidak melebar ke samping) --- */
#output {
    background: #000000;
    padding: 15px;
    border: 2px solid #808080;
    margin-top: 15px;
    font-size: 1.2em;
    color: #00ff00;
    text-shadow: 0 0 5px #00ff00;
    min-height: 50px;

    /* penting: biarkan teks membungkus dan pindah ke baris baru */
    white-space: pre-wrap;       /* mempertahankan newline jika ada, tapi tetap wrap */
    word-wrap: break-word;       /* pecah kata panjang bila perlu */
    overflow-wrap: anywhere;     /* break anywhere untuk kata super panjang */
    word-break: break-word;      /* fallback untuk beberapa browser */

    max-width: 100%;
    box-sizing: border-box;

    /* jangan biarkan scroll horizontal muncul */
    overflow-x: hidden;

    /* jika hasil sangat panjang, scroll vertikal diperbolehkan */
    max-height: 200px;
    overflow-y: auto;
}

/* Modal and result styling */
.modal { 
    display: none; 
    position: fixed; 
    z-index: 10; 
    left: 0; 
    top: 0; 
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgba(0,0,0,0.8); 
}
.modal-content { 
    background-color: #e0e0e0; 
    margin: 0; 
    padding: 20px; 
    border: 2px solid #808080; 
    text-align: center; 
    border-radius: 0; 
    box-shadow: 5px 5px 0px 0px rgba(0,0,0,0.75); 
    width: 100vw; 
    height: 100vh; 
    box-sizing: border-box; 
    display: flex; 
    flex-direction: column; 
    justify-content: center; 
    align-items: center; 
}
.closeBtn { 
    color: #333; 
    position: absolute; 
    top: 10px; 
    right: 20px; 
    font-size: 28px; 
    font-weight: bold; 
    cursor: pointer; 
}
.closeBtn:hover { color: #ff0000; }

#resultModal .modal-content img, #resultModal .modal-content video { 
    max-width: 90vw; 
    max-height: 80vh; 
    width: auto; 
    height: auto; 
    border: 2px solid #555; 
    object-fit: contain; 
}

/* Action buttons wrapper: dua tombol sejajar, kiri & kanan */
.action-buttons { 
    display: flex; 
    justify-content: space-between; 
    gap: 10px; 
    width: 100%; 
    max-width: 360px; 
    margin: 12px auto 0 auto;
}
.action-buttons button { 
    flex: 1 1 48%; 
    display: inline-block; 
    margin: 0; 
}

/* Keep existing buttons style on hover */
#downloadBtn, #downloadQRBtn, #copyTextBtn, #openLinkBtn, #searchGoogleBtn { 
    padding: 10px; font-size: 1.1em; border: 2px solid #808080; 
    background: #c0c0c0; color: #333; cursor: pointer; font-family: 'VT323', monospace; 
    text-transform: uppercase; box-shadow: 2px 2px 0px 0px rgba(0,0,0,0.75); transition: all 0.1s ease; 
}
#downloadBtn:hover, #downloadQRBtn:hover, #copyTextBtn:hover, #openLinkBtn:hover, #searchGoogleBtn:hover { 
    background: #a0a0a0; transform: translate(1px,1px); 
}
#resultContainer { 
    max-height: 80vh; 
    overflow-y: auto; 
    word-wrap: break-word; 
    overflow-wrap: break-word; 
    flex-grow: 1; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
}

/* === STYLE CHECKBOX: desain klasik ===
    - Kita sembunyikan checkbox default dan gunakan label:before/after
    - Tetap kompatibel dengan HTML input + label yang ada
*/
.checkbox-wrapper {
    margin-top: 10px;
    font-size: 1.1em;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:8px;
    position: relative;
}

/* sembunyikan checkbox browser default tapi tetap aksesibel */
.checkbox-wrapper input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
    margin: 0;
    left: -9999px;
}

/* style label untuk menjadi kotak klasik + teks */
.checkbox-wrapper label {
    position: relative;
    padding-left: 34px; /* ruang untuk kotak */
    cursor: pointer;
    user-select: none;
    color: #333;
    display: inline-block;
    line-height: 20px;
    font-size: 1.05em;
}

/* kotak putih dengan border tegas (classic look) */
.checkbox-wrapper label::before {
    content: "";
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 22px;
    height: 22px;
    border: 2px solid #555;
    background: #ffffff;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,0.02);
    border-radius: 3px;
}

/* tanda centang: dibuat dengan pseudo-element, hitam klasik */
.checkbox-wrapper label::after {
    content: "";
    position: absolute;
    left: 6px;
    top: 50%;
    transform: translateY(-60%) rotate(45deg);
    width: 6px;
    height: 12px;
    border: solid #000;
    border-width: 0 2px 2px 0;
    opacity: 0;
    transition: opacity 0.08s ease;
}

/* tampilkan centang saat checkbox dicentang */
.checkbox-wrapper input[type="checkbox"]:checked + label::after {
    opacity: 1;
}

/* hover pada label: sedikit gelap pada border kotak */
.checkbox-wrapper label:hover::before {
    border-color: #333;
}
</style>
</head>
<body>

<div class="container">
    <h1>QR & Barcode Decoder v3.0</h1>
    <!-- Gunakan video terpisah untuk umpan langsung -->
    <div id="video-stream-container">
        <!-- Elemen video ini diperlukan untuk mengambil stream data kamera,
             tetapi tidak ditampilkan kepada pengguna. -->
        <video id="liveVideo" autoplay style="display: none;"></video> 
        <!-- Canvas ini akan menampilkan video dengan filter kontur -->
        <canvas id="contourCanvas"></canvas>
    </div>

    <!-- Canvas tersembunyi untuk mengambil snapshot dan mendeteksi kode -->
    <canvas id="snapshot"></canvas>

    <div class="controls">
        <button id="startCameraButton">Start Camera</button>
        <button id="fileInputBtn">Pilih Gambar</button>
        <input type="file" id="fileInput" accept="image/*">
        <button id="createQRBtn">Buat QR</button>
    </div>

    <div class="checkbox-wrapper">
        <input type="checkbox" id="luckyCheck" />
        <label for="luckyCheck">Saya beruntung</label>
    </div>

    <div id="output">STATUS: READY</div>

    <!-- action-buttons: kiri = Copy Teks, kanan = Buka Link OR Cari di Google -->
    <div id="actionButtons" class="action-buttons" style="display: none;">
        <button id="copyTextBtn">Copy Teks</button>
        <button id="rightActionBtn">Aksi</button>
    </div>
</div>

<!-- Modal QR Generator -->
<div id="qrModal" class="modal">
    <div class="modal-content">
        <span class="closeBtn" id="closeQRModal">&times;</span>
        <h2>Buat QR Code</h2>
        <input type="text" id="qrText" placeholder="Masukkan teks/link..." style="width:90%; padding:10px; font-family: 'VT323'; font-size:1em; border: 2px solid #808080; background: #c0c0c0; color: #333;">
        <canvas id="qrCanvas"></canvas>
        <button id="downloadQRBtn">Download QR</button>
    </div>
</div>

<!-- Modal Hasil QR Gambar/Video -->
<div id="resultModal" class="modal">
    <div class="modal-content">
        <span class="closeBtn" id="closeResultModal">&times;</span>
        <div id="resultContainer"></div>
        <button id="downloadBtn">Download Image</button>
    </div>
</div>

<script>
/* === Elemen DOM === */
const liveVideo = document.getElementById('liveVideo');
const contourCanvas = document.getElementById('contourCanvas');
const snapshot = document.getElementById('snapshot');
const output = document.getElementById('output');
const fileInput = document.getElementById('fileInput');
const fileInputBtn = document.getElementById('fileInputBtn');
const startCameraButton = document.getElementById('startCameraButton');
const createQRBtn = document.getElementById('createQRBtn');

const qrModal = document.getElementById('qrModal');
const closeQRModal = document.getElementById('closeQRModal');
const qrText = document.getElementById('qrText');
const qrCanvas = document.getElementById('qrCanvas');
const downloadQRBtn = document.getElementById('downloadQRBtn');

const resultModal = document.getElementById('resultModal');
const closeResultModal = document.getElementById('closeResultModal');
const resultContainer = document.getElementById('resultContainer');
const downloadBtn = document.getElementById('downloadBtn');

const actionButtons = document.getElementById('actionButtons');
const copyTextBtn = document.getElementById('copyTextBtn');
const rightActionBtn = document.getElementById('rightActionBtn');

const luckyCheck = document.getElementById('luckyCheck');

let stream = null, animationFrameId = null;
let lastDecodedData = null;
let lastDecodedDataLink = null;
let lastDecodedText = null;

/* === Fungsi beep (notifikasi suara) === */
function playBeep() {
    try {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioCtx.createOscillator();
        const gainNode = audioCtx.createGain();
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(1.0, audioCtx.currentTime);
        oscillator.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.start();
        oscillator.stop(audioCtx.currentTime + 0.2);
    } catch (err) { console.error("Audio error:", err); }
}

/* === Caesar Cipher mundur === */
function caesarDecipher(str, shift) {
    let result = '';
    for (let i = 0; i < str.length; i++) {
        let code = str.charCodeAt(i);
        if (code >= 65 && code <= 90) result += String.fromCharCode((code - 65 - shift + 26) % 26 + 65);
        else if (code >= 97 && code <= 122) result += String.fromCharCode((code - 97 - shift + 26) % 26 + 97);
        else result += str[i];
    }
    return result;
}

/* === Tampilkan hasil decode (base64 / link / teks) === */
function showDecodedBase64(data) {
    output.textContent = '';
    resultContainer.innerHTML = '';
    lastDecodedData = null;
    downloadBtn.style.display = 'none';
    actionButtons.style.display = 'none';
    lastDecodedDataLink = null;
    lastDecodedText = null;

    if (data.startsWith('data:image/')) {
        let img = document.createElement('img');
        img.src = data;
        resultContainer.appendChild(img);
        lastDecodedData = data;
        downloadBtn.style.display = 'block';
        resultModal.style.display = 'block';
    } else if (data.startsWith('data:video/')) {
        let vid = document.createElement('video');
        vid.src = data;
        vid.controls = true;
        vid.loop = true;
        vid.autoplay = true;
        resultContainer.appendChild(vid);
        resultModal.style.display = 'block';
    } else {
        // untuk teks atau link, delegasikan ke processQRData agar tombol muncul sesuai aturan
        processQRData(data);
    }
}

/* tombol aksi */
copyTextBtn.addEventListener('click', () => {
    if(lastDecodedText) {
        try { 
            document.execCommand('copy');
            // Ganti alert dengan pesan di output
            output.textContent = "Teks berhasil disalin!";
            setTimeout(() => { output.textContent = lastDecodedText; }, 1500);
        } catch (e) { 
            output.textContent = "Gagal menyalin. Silakan salin manual: " + lastDecodedText;
        }
    }
});
rightActionBtn.addEventListener('click', () => {
    if (lastDecodedDataLink) {
        window.open(lastDecodedDataLink, "_blank");
    } else if (lastDecodedText) {
        const q = encodeURIComponent(lastDecodedText);
        window.open(`https://www.google.com/search?q=${q}`, '_blank');
    }
});
downloadBtn.addEventListener('click', () => {
    if (!lastDecodedData) return;
    const a = document.createElement('a');
    a.href = lastDecodedData;
    a.download = 'decoded_image.png';
    a.click();
});

/* === Tombol pilih file === */
fileInputBtn.addEventListener('click', () => {
    fileInput.click();
});

/* === Fetch raw & decrypt === */
async function fetchAndDecrypt(link, shift) {
    try {
        output.textContent = "STATUS: FETCHING RAW DATA...";
        let res = await fetch(link);
        if (!res.ok) throw new Error("HTTP " + res.status);
        let rawText = await res.text();
        let shifted = caesarDecipher(rawText, shift);
        showDecodedBase64(shifted);
    } catch (err) { output.textContent = "ERROR: " + err; }
}

/* === Kamera start/stop === */
function stopCamera() {
    if (stream) { stream.getTracks().forEach(t => t.stop()); stream = null; }
    if (animationFrameId) cancelAnimationFrame(animationFrameId);
    // liveVideo.style.display = 'none'; // liveVideo memang sudah disembunyikan
    contourCanvas.style.display = 'none';
}

async function startCamera() {
    stopCamera();
    try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }});
        liveVideo.srcObject = stream;
        // liveVideo tidak ditampilkan, hanya digunakan sebagai sumber data.
        contourCanvas.style.display = 'block';
        liveVideo.play();
        scanQRCode();
    } catch (err) { output.textContent = "ERROR: " + err; }
}

function toggleCamera() {
    if (stream) {
        stopCamera();
        startCameraButton.textContent = 'Start Camera';
    } else {
        startCamera();
        startCameraButton.textContent = 'Stop Camera';
    }
}

/* === Barcode detection helper (promisified) === */
function tryDecodeBarcodeFromCanvas(canvas) {
    return new Promise((resolve) => {
        if ('BarcodeDetector' in window) {
            try {
                const formats = ["code_128","code_39","code_93","ean_13","ean_8","upc_e","upc_a","itf","codabar"];
                const detector = new BarcodeDetector({ formats });
                detector.detect(canvas).then(results => {
                    if (results && results.length > 0) {
                        resolve(results[0].rawValue || null);
                    } else resolve(null);
                }).catch(err => {
                    console.warn("BarcodeDetector error:", err);
                    resolve(null);
                });
                return;
            } catch (err) {
                console.warn("BarcodeDetector exception:", err);
            }
        }

        try {
            const src = canvas.toDataURL();
            if (window.Quagga && Quagga.decodeSingle) {
                Quagga.decodeSingle({
                    src,
                    numOfWorkers: 0,
                    inputStream: { size: 800 },
                    locator: { patchSize: "medium", halfSample: true },
                    decoder: {
                        readers: [
                            "code_128_reader","ean_reader","ean_8_reader","code_39_reader",
                            "upc_reader","upc_e_reader","codabar_reader","i2of5_reader"
                        ]
                    }
                }, function(result) {
                    if (result && result.codeResult && result.codeResult.code) {
                        resolve(result.codeResult.code);
                    } else resolve(null);
                });
            } else {
                resolve(null);
            }
        } catch (err) {
            console.warn("Quagga fallback error:", err);
            resolve(null);
        }
    });
}

/* === Fungsi untuk deteksi tepi (Canny-like) === */
function detectEdges(imageData) {
    const data = imageData.data;
    const width = imageData.width;
    const height = imageData.height;
    const outputData = new Uint8ClampedArray(data.length);

    // Konversi ke grayscale terlebih dahulu
    for (let i = 0; i < data.length; i += 4) {
        const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
        data[i] = avg;
        data[i + 1] = avg;
        data[i + 2] = avg;
    }

    // Kernel Sobel untuk deteksi tepi horizontal dan vertikal
    const sobelX = [ -1, 0, 1, -2, 0, 2, -1, 0, 1 ];
    const sobelY = [ -1, -2, -1, 0, 0, 0, 1, 2, 1 ];

    for (let y = 1; y < height - 1; y++) {
        for (let x = 1; x < width - 1; x++) {
            let gx = 0;
            let gy = 0;

            for (let ky = -1; ky <= 1; ky++) {
                for (let kx = -1; kx <= 1; kx++) {
                    const pixelIndex = ((y + ky) * width + (x + kx)) * 4;
                    const kernelIndex = (ky + 1) * 3 + (kx + 1);
                    const pixelValue = data[pixelIndex];
                    gx += pixelValue * sobelX[kernelIndex];
                    gy += pixelValue * sobelY[kernelIndex];
                }
            }

            const magnitude = Math.sqrt(gx * gx + gy * gy);
            const outputIndex = (y * width + x) * 4;
            
            // Perubahan: Tampilkan tepi yang kuat dengan warna hijau
            if (magnitude > 100) {
                outputData[outputIndex] = 0; // Merah
                outputData[outputIndex + 1] = 255; // Hijau
                outputData[outputIndex + 2] = 0; // Biru
            } else {
                outputData[outputIndex] = 0;
                outputData[outputIndex + 1] = 0;
                outputData[outputIndex + 2] = 0;
            }
            outputData[outputIndex + 3] = 255; // Alpha
        }
    }
    return new ImageData(outputData, width, height);
}

/* === Scan QR + barcode di kamera === */
function scanQRCode() {
    const ctx = snapshot.getContext('2d');
    const contourCtx = contourCanvas.getContext('2d');

    async function tick() {
        if (liveVideo.readyState === liveVideo.HAVE_ENOUGH_DATA) {
            const w = liveVideo.videoWidth;
            const h = liveVideo.videoHeight;
            snapshot.width = w;
            snapshot.height = h;
            contourCanvas.width = w;
            contourCanvas.height = h;
            
            // Gambar frame video ke canvas tersembunyi
            ctx.drawImage(liveVideo, 0, 0, w, h);

            // Ambil data gambar dari canvas tersembunyi
            const imageData = ctx.getImageData(0, 0, w, h);

            // Terapkan deteksi tepi dan gambar ke canvas yang terlihat
            const edgeData = detectEdges(imageData);
            contourCtx.putImageData(edgeData, 0, 0);

            // Coba mendeteksi kode QR dari data gambar asli (bukan yang sudah diproses)
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            if (code) {
                stopCamera();
                startCameraButton.textContent = 'Start Camera';
                playBeep();
                output.textContent = "QR FOUND: " + code.data;
                processQRData(code.data);
                return;
            }

            try {
                const barcode = await tryDecodeBarcodeFromCanvas(snapshot);
                if (barcode) {
                    stopCamera();
                    startCameraButton.textContent = 'Start Camera';
                    playBeep();
                    output.textContent = "BARCODE FOUND: " + barcode;
                    processQRData(barcode);
                    return;
                }
            } catch (err) {
                console.warn("Barcode check failed:", err);
            }
        }
        animationFrameId = requestAnimationFrame(tick);
    }
    tick();
}

/* === Proses hasil decode === */
function processQRData(data) {
    // reset
    lastDecodedData = null;
    downloadBtn.style.display = 'none';
    actionButtons.style.display = 'none';
    lastDecodedDataLink = null;
    lastDecodedText = null;
    output.textContent = '';

    // Pisah dengan delimiter ||
    let parts = data.split("||").map(p => p.trim());

    if (luckyCheck.checked) {
        // MODE "SAYA BERUNTUNG": jika format cocok -> fetch + decrypt
        if (parts.length === 2 && parts[0].startsWith("http") && !isNaN(parseInt(parts[1]))) {
            fetchAndDecrypt(parts[0], parseInt(parts[1]));
            return;
        }
        // jika bukan format raw||angka, fallback normal (tampilkan link/teks)
    }

    // MODE NORMAL atau fallback dari lucky: tampilkan mentah dan siapkan tombol
    output.textContent = "" + data;
    lastDecodedText = data; // selalu tersedia untuk copy teks

    // Jika hasil adalah link -> set lastDecodedDataLink dan ubah tombol kanan jadi "Buka Link"
    if (data.startsWith("http://") || data.startsWith("https://")) {
        lastDecodedDataLink = data;

        actionButtons.style.display = 'flex';
        copyTextBtn.style.display = 'inline-block';
        rightActionBtn.style.display = 'inline-block';
        rightActionBtn.textContent = 'Buka Link';

        // optional: tambahkan tooltip (title)
        copyTextBtn.title = 'Copy hasil (link)';
        rightActionBtn.title = 'Buka link di tab baru';
    } else {
        // teks biasa -> tombol kanan = Cari di Google
        actionButtons.style.display = 'flex';
        copyTextBtn.style.display = 'inline-block';
        rightActionBtn.style.display = 'inline-block';
        rightActionBtn.textContent = 'Cari di Google';

        copyTextBtn.title = 'Copy teks';
        rightActionBtn.title = 'Cari teks di Google';
    }
}

/* === Upload file handling === */
fileInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file) return;
    stopCamera();
    startCameraButton.textContent = 'Start Camera';
    const reader = new FileReader();
    reader.onload = async ev => {
        const img = new Image();
        img.onload = async function() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img,0,0);
            const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
            const code = jsQR(imageData.data,imageData.width,imageData.height);
            if(code){
                playBeep();
                output.textContent="QR FOUND: "+code.data;
                processQRData(code.data);
                return;
            }

            output.textContent = "Mencoba deteksi barcode pada gambar...";
            try {
                const barcode = await tryDecodeBarcodeFromCanvas(canvas);
                if (barcode) {
                    playBeep();
                    output.textContent = "BARCODE FOUND: " + barcode;
                    processQRData(barcode);
                } else {
                    output.textContent = "No QR or barcode found in image";
                    downloadBtn.style.display='none';
                    actionButtons.style.display='none';
                }
            } catch(err) {
                output.textContent = "Error saat deteksi barcode: " + err;
            }
        };
        img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
});

startCameraButton.addEventListener('click', toggleCamera);

/* === QR Generator === */
createQRBtn.addEventListener('click', () => {
    qrModal.style.display = 'block';
    generateQRFromInput();
});
closeQRModal.addEventListener('click', () => { location.reload(); });
closeResultModal.addEventListener('click', () => { location.reload(); });
qrText.addEventListener('input', generateQRFromInput);
function generateQRFromInput() {
    const text = qrText.value.trim() || " ";
    new QRious({
        element: qrCanvas,
        value: text,
        size: 300,
        level: 'H',
        background: '#e0e0e0',
        foreground: '#333333'
    });
}
downloadQRBtn.addEventListener('click', () => {
    const a = document.createElement('a');
    a.href = qrCanvas.toDataURL("image/png");
    a.download = 'qr_code.png';
    a.click();
});

/* Tutup modal saat klik area luar (tanpa reload) */
window.addEventListener('click', (e) => {
    if(e.target===qrModal) qrModal.style.display='none';
    if(e.target===resultModal) resultModal.style.display='none';
});
</script>
</body>
</html>
